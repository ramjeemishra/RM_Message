<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TS chat</title>
  <!-- <link rel="shortcut icon" href="public/img/chatlogoo.png" style="width: max-content; height: max-content;"
    type="image/x-icon"> -->
  <link rel="shortcut icon" href="img/chatlogoo.png" type="image/x-icon">
  <link rel="stylesheet" href="ccsss/style.css">
  <link rel="stylesheet" href="ccsss/another.css">
  <!-- <link rel="stylesheet" href="emoji.css"> -->
  <script src="https://kit.fontawesome.com/7221c7cc44.js" crossorigin="anonymous"></script>
  <style>
    .buttons {
      margin-bottom: -250px;
      position: fixed;
      z-index: 4;
      width: max-content;
      display: flex;
      padding-top: 15px;
      padding-bottom: 15px;
      padding-right: 15px;
      padding-left: 15px;
      flex-wrap: wrap;
      gap: 10px;
      border: 1px solid black;
      border-radius: 15px 0px 15px 0px;
      background-color: #ffffff98;
      animation: shadow-pulse 2s infinite alternate;
    }

    @keyframes shadow-pulse {
      0% {
        box-shadow: 0px 0px 10px 5px rgba(0, 0, 0, 0.1);
      }

      100% {
        box-shadow: 0px 0px 20px 10px rgba(255, 255, 255, 0.693);
      }
    }

    .buttons button {
      padding: 8px 16px;
      background-color: #13171c;
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      display: block;
      font-weight: 700;
      margin-bottom: 15px;
    }

    /* CSS for the main button */
    .main button {
      padding: 10px 20px;
      /* background-color: #4CAF50; */
      /* color: white; */
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: block;
    }

    .me{
      background-color: rgba(0, 0, 0, 0.6);
      color: aliceblue;
    }
    .nexus{
      background-color:rgb(245 245 245 / 36%);
      color: #000000;
    }
    .sender.me {
      background: -webkit-linear-gradient(#eee, #10e7ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }

    .sender.nexus {
      background: -webkit-linear-gradient(#eee, #10ff23);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }


    @media (min-width: 1198px) {
      .tsinput {
        width: 64vw;
      }

      .clearbtn i {
        position: fixed;
        margin-left: 70%;
        font-size: 2rem;
        margin-top: -114px;
      }
    }

    @media (max-width: 1197px) {
      .tsinput {
        width: 54vw;
      }

      .clearbtn i {
        position: fixed;
        margin-left: 67%;
        font-size: 2rem;
        margin-top: -114px;
      }
    }

    @media (max-width: 1080px) {
      .clearbtn i {
        position: fixed;
        margin-left: 64%;
        font-size: 2rem;
        margin-top: -114px;
      }
    }

    @media (max-width: 997px) {
      .tsinput {
        width: 54vw;
      }

      .clearbtn i {
        position: fixed;
        margin-left: 60%;
        font-size: 2rem;
        margin-top: -114px;
      }
    }

    @media (max-width: 897px) {
      .tsinput {
        width: 76vw;
      }

      .clearbtn i {
        position: fixed;
        margin-left: 79%;
        font-size: 2rem;
        margin-top: -133px;
      }
    }

    @media (max-width: 768px) {
      .tsinput {
        width: 65vw;
      }
    }

    @media (max-width: 590px) {
      .clearbtn i {
        margin-left: 69%;
      }
    }

    @media (max-width: 480px) {
      .tsinput {
        width: 216px;
      }
    }

    .clearbtn i {
      background: -webkit-linear-gradient(#8c2d2d, #01ff00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: transform 0.5s ease, background-color 0.3s ease;
    }

    .clearbtn i:hover {
      transform: rotate(360deg);
      background: -webkit-linear-gradient(#00ccff, #00ff00aa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      cursor: pointer;
    }

    /* button code */

    .button-57 {
      position: relative;
      overflow: hidden;
      border: 1px solid #18181a;
      color: #18181a;
      display: inline-block;
      font-size: 15px;
      line-height: 15px;
      padding: 18px 18px 17px;
      text-decoration: none;
      cursor: pointer;
      background: #fff;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    .button-57 span:first-child {
      position: relative;
      transition: color 600ms cubic-bezier(0.48, 0, 0.12, 1);
      z-index: 10;
    }

    .button-57 span:last-child {
      color: white;
      display: block;
      position: absolute;
      bottom: 0;
      transition: all 500ms cubic-bezier(0.48, 0, 0.12, 1);
      z-index: 100;
      opacity: 0;
      top: 50%;
      left: 50%;
      transform: translateY(225%) translateX(-50%);
      height: 14px;
      line-height: 13px;
    }

    .button-57:after {
      content: "";
      position: absolute;
      bottom: -50%;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      transform-origin: bottom center;
      transition: transform 600ms cubic-bezier(0.48, 0, 0.12, 1);
      transform: skewY(9.3deg) scaleY(0);
      z-index: 50;
    }

    .button-57:hover:after {
      transform-origin: bottom center;
      transform: skewY(9.3deg) scaleY(2);
    }

    .button-57:hover span:last-child {
      transform: translateX(-50%) translateY(-100%);
      opacity: 1;
      transition: all 900ms cubic-bezier(0.48, 0, 0.12, 1);
    }

    .containerr {
      text-align: center;
    }

    #emojiInput {
      padding: 10px;
      width: 200px;
      font-size: 16px;
    }

    #toggleEmojiPanel {
      border: none;
      background-color: #dddddd00;
      font-size: 1.5rem;
      cursor: pointer;
      padding-right: 0px;
      margin-left: -12%;
    }

    @media (min-width: 457px) {
      #toggleEmojiPanel {
        margin-left: -5%;
      }
    }

    @media (min-width: 979px) {
      #toggleEmojiPanel {
        margin-left: -2%;
      }

      /* .emoji-panel{
    overflow-x: scroll;
    height: 45px;
  } */
    }

    .emoji-panel {
    display: none;
    margin-top: -196px;
    width: 500px;
    position: fixed;
    padding: 10px;
    background-color: #302e2ec7;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    max-height: 200px;
    overflow-y: auto;
    }
@media (max-width:1000px) {
  .emoji-panel{
    width:55dvw;
  }
}
    .emoji-container {
      display: flex;
      flex-wrap: wrap;
    }

    .emoji {
      font-size: 24px;
      cursor: pointer;
      margin: 5px;
      transition: transform 0.2s;
    }

    .emoji:hover {
      transform: scale(1.2);
    }

    #user-msg {
      font-size: 16px;
      background-color: white;
      padding: 10px 20px;
      outline: none;
      border: none;
      width: 100%;
      border-radius: 50px 0 0 50px;
    }


    
  </style>
</head>

<body>



  <main id="content">
    <div class="updates" id="updates">
      <button id="udatescloseButton">Home</button>
      <div class="updates-content">
          <h2 class="updates-heading">🚀 Latest Features and Updates</h2>
          <ul class="updates-list">
              <li>
                  <strong>AI Assistant Nexus:</strong> Chat with super-fast responses, offering seamless interactions.
              </li>
              <li class="generate-images-li">
                <strong>Generate Images:</strong> Use the keyword "<code>generate</code>" to create stunning images instantly in chat.
                <span class="demo-example">Example: <code>'generate a cute puppy'</code></span> <!-- Example text displayed -->
                <strong>Play game</strong> now you can play <code>rock, paper, scissors</code>.
                <span class="demo-example">Example: <code>'let's play game'</code></span>
            </li>
              <li>
                  <strong>Enhanced Chat Features:</strong> Experience a powerful AI chatbot for efficient and smooth conversations.
              </li>
              <li class="improved-update">
                <strong>Improved Features & User Experience:</strong> 
                <p>This update, we have improved more features and enhanced the user experience to make it easier to use.</p>
                <ul class="feature-list">
                    <li>📊 <strong>Improved Performance:</strong> Faster load times and optimized AI processing for quicker responses.</li>
                    <li>🔧 <strong>Enhanced Customization:</strong> More options to personalize your chat interface.</li>
                    <li><strong>History:</strong> Now whatever you create is stored.</li>
                </ul>
                <ul class="improvement-list">
                    <li>✨ <strong>Simplified Interface:</strong> Cleaner, more intuitive layout for a better user experience.</li>
                    <li>🚀 <strong>Better Navigation:</strong> Easier access to key features with fewer clicks.</li>
                </ul>
            </li>
          </ul>
      </div>
  </div>

</div>
    <div id="settingsOverlay">
      <div id="settingsContent">
          <div id="appVersion">
              Version 1.0.1
          </div>
          <button id="closeButton" style="display: block;">X</button>
          <button id="muteButton"style="display: block;">Mute</button>
          <button id="show-history-button">Show History</button>
          <div id="history-overlay" style="display: none;">
              <button id="close-history-button">Close</button>
              <div id="history-container"></div>
          </div>
          
          <button id="newupdate"style="display: block;">what's new this update</button>

      </div>
  </div>

    <header>
      <div class="title">
        <img src="img/chatlog.jpg" width="35px" alt="">
        <h1>TS</h1><img class="tick" src="img/verify.png" alt="tick">
      </div>
      <div class="main"><button class="button-57" onclick="show_hide1()"><span
            class="text">MORE</span><span>HIDE</span></button></div>

      <div class="buttons" style="display: none;" id="additionalButtons">
        <button id="button2" accesskey="a" class="rotate-button" style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">TS
          AI</button>
        <button id="button1" accesskey="c">CHAT box</button>
        <button type="button" id="clearChatBtn" class="Clear">Clear chat</button>
        <button id="fullscreenButton">Fullscreen</button>
        <button class="Clear" style="cursor: pointer; background-color: rgb(0, 0, 0); color: lavender;"
          onmouseover="this.style.backgroundColor='lightgray'" onmouseout="this.style.backgroundColor='black'"
          onclick="navigator.clipboard.writeText('https://rm-message.onrender.com/')">copy invite link</button>
        <button id="settingsButton">Settings</button>
      </div>
      <button type="button" onclick="show_hide()">
        <i class="fa-solid fa-users fa-fade" font-size="large" style="color: #000000;"></i>
      </button>
    </header>

    <div class="container">

      <div class="users-window">
        <div class="users-head">
          <h3>Users__online</h3>
          <h4 class="users-count">1</h4>
        </div>
        <div class="users-list">
        </div>
      </div>

      <div id="tab1" class="chat-window">
        <div class="chats" id="messages">
          <p
            style="border: 1px solid black; color: white; padding: 5px 5px 5px 5px; border-radius: 9px; text-align: center;">
            Your chats can be seen by all the user</p>

          <div class="imagePreview"><div id="imagePreview"></div><button id="sendimg" style="display: none;">Send</button></div>
          

        </div>
        <div class="containerr">
          <div id="emojiPanel" class="emoji-panel">
            <div class="emoji-container">
              <span class="emoji">😀</span>
              <span class="emoji">😁</span>
              <span class="emoji">😂</span>
              <span class="emoji">🤣</span>
              <span class="emoji">😃</span>
              <span class="emoji">😄</span>
              <span class="emoji">😅</span>
              <span class="emoji">😆</span>
              <span class="emoji">😉</span>
              <span class="emoji">😊</span>
              <span class="emoji">😋</span>
              <span class="emoji">😎</span>
              <span class="emoji">😍</span>
              <span class="emoji">😘</span>
              <span class="emoji">😗</span>
              <span class="emoji">😙</span>
              <span class="emoji">😚</span>
              <span class="emoji">🙂</span>
              <span class="emoji">🤗</span>
              <span class="emoji">🤩</span>
              <span class="emoji">🤔</span>
              <span class="emoji">🤨</span>
              <span class="emoji">😐</span>
              <span class="emoji">😑</span>
              <span class="emoji">😶</span>
              <span class="emoji">🙄</span>
              <span class="emoji">😏</span>
              <span class="emoji">😣</span>
              <span class="emoji">😥</span>
              <span class="emoji">😮</span>
              <span class="emoji">🤐</span>
              <span class="emoji">😯</span>
              <span class="emoji">😪</span>
              <span class="emoji">😫</span>
              <span class="emoji">😴</span>
              <span class="emoji">😌</span>
              <span class="emoji">😛</span>
              <span class="emoji">😜</span>
              <span class="emoji">😝</span>
              <span class="emoji">🤤</span>
              <span class="emoji">😒</span>
              <span class="emoji">😓</span>
              <span class="emoji">😔</span>
              <span class="emoji">😕</span>
              <span class="emoji">🙃</span>
              <span class="emoji">🤑</span>
              <span class="emoji">😲</span>
              <span class="emoji">☹️</span>
              <span class="emoji">🙁</span>
              <span class="emoji">😖</span>
              <span class="emoji">😞</span>
              <span class="emoji">😟</span>
              <span class="emoji">😤</span>
              <span class="emoji">😢</span>
              <span class="emoji">😭</span>
              <span class="emoji">😦</span>
              <span class="emoji">😧</span>
              <span class="emoji">😨</span>
              <span class="emoji">😩</span>
              <span class="emoji">🤯</span>
              <span class="emoji">😬</span>
              <span class="emoji">😰</span>
              <span class="emoji">😱</span>
              <span class="emoji">🥵</span>
              <span class="emoji">🥶</span>
              <span class="emoji">😳</span>
              <span class="emoji">🤪</span>
              <span class="emoji">😵</span>
              <span class="emoji">😡</span>
              <span class="emoji">😠</span>
              <span class="emoji">🤬</span>
              <span class="emoji">😷</span>
              <span class="emoji">🤒</span>
              <span class="emoji">🤕</span>
              <span class="emoji">🤢</span>
              <span class="emoji">🤮</span>
              <span class="emoji">🤧</span>
              <span class="emoji">😇</span>
              <span class="emoji">🥳</span>
              <span class="emoji">🥺</span>
              <span class="emoji">🤠</span>
              <span class="emoji">🤡</span>
              <span class="emoji">🤥</span>
              <span class="emoji">🤫</span>
              <span class="emoji">🤭</span>
              <span class="emoji">🧐</span>
              <span class="emoji">🤓</span>
              <span class="emoji">😈</span>
              <span class="emoji">👿</span>
              <span class="emoji">👹</span>
              <span class="emoji">👺</span>
              <span class="emoji">💀</span>
              <span class="emoji">👻</span>
              <span class="emoji">👽</span>
              <span class="emoji">🤖</span>
              <span class="emoji">💩</span>
              <span class="emoji">😺</span>
              <span class="emoji">😸</span>
              <span class="emoji">😹</span>
              <span class="emoji">😻</span>
              <span class="emoji">😼</span>
              <span class="emoji">😽</span>
              <span class="emoji">🙀</span>
              <span class="emoji">😿</span>
              <span class="emoji">😾</span>
            </div>
          </div>
        </div>
        <div class="user-input">

          <input type="file" id="imageInput" accept="image/*" style="display: none;">
          <button id="toggleEmojiPanel" accesskey="e">😊</button>
          <input id="user-msg" type="text" placeholder="Send me your thoughts... 🫣">
          <button type="button" id="user-send">Send</button>
          <label for="imageInput">
            <img src="/img/upload.png" alt="Upload Image" style="cursor: pointer;" id="uploadButton">
          </label>
          <!-- <textarea name="" id="user-msg" rows="1" placeholder="Send me your thoughts... 🫣"></textarea> -->
          <!-- <button id="sendImageBtn">Send Image</button> -->
        </div>
      </div>


      <!-- <div id="tab2" class="chat-window" style="display: none;">
        <div class="chat-container" id="chats">
          <p
            style="border: 1px solid black; color: white; padding: 5px 5px 5px 5px; border-radius: 9px; text-align: center;">
            You are chatting with our ai</p>

        </div>
        <div class="user-input">
          <input id="user-msg" type="text" placeholder="Type your message">
          <button type="button" id="user-send" onclick="sendMessage()">Send</button>
        </div>
      </div> -->




      <div id="tab2" class="chat-window" style="display: none;">
        <div class="chat-container" id="chats">
          <p
            style="border: 1px solid black; color: white; padding: 5px 5px 5px 5px; border-radius: 9px; text-align: center;">
            You are chatting with our ai</p>
          <div id="chat-box"
            style="flex: 1; padding: 20px; height: 75dvh; overflow-y: scroll; border-bottom: 1px solid #ddd; display: flex; flex-direction: column; gap: 10px;">
            <!-- <img id="image" width="50%" height="50%" src="" alt=""> -->
            <div class="feature" style="display: flex; flex-grow: initial; gap: 5dvw; height: fit-content;">
            <div class="feature1" style="color: #ffffff; width: fit-content; font-size: 24px; font-weight: bold; text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1); cursor: pointer;" onclick="createAndShowGameDiv()">Let's play game</div>
            <div class="clickable-div" style="color: #ffffff; width: fit-content; font-size: 24px; font-weight: bold; text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1); cursor: pointer;">Generate images</div>
          </div>


          </div>
          <div
            style="display: flex; padding: 10px; position: fixed; background-color: #f8f9fa00; border-top: 1px solid #ddd;"
            class="input_area">
            <!-- <p id="status" class="hidden">Your image is being generated...</p> -->
            <span class="clearbtn"><i class="fa-solid fa-broom"></i></span>
            <input class="tsinput" id="user-input" type="text" placeholder="Type your message here..."
              style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 20px; margin-right: 10px; font-size: 16px; outline: none;" />
            <button id="send-buttonn" onclick="sendMessage()"
              style="padding: 10px 20px; border: none; background-color: #007bff; color: #fff; border-radius: 20px; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease;">Send</button>
          </div>
        </div>


      </div>

  </main>


  <script>
    document.querySelector('.clickable-div').addEventListener('click', function() {
        document.getElementById('user-input').value = 'generate';
    });





    // setting buttion
document.getElementById('settingsButton').addEventListener('click', function() {
    document.getElementById('settingsOverlay').style.display = 'flex';
});

document.getElementById('closeButton').addEventListener('click', function() {
    document.getElementById('settingsOverlay').style.display = 'none';
});



//updates
document.getElementById('newupdate').addEventListener('click', function() {
    document.getElementById('updates').style.display = 'flex';
    document.getElementById('settingsOverlay').style.display = 'none';
});

document.getElementById('udatescloseButton').addEventListener('click', function() {
    document.getElementById('updates').style.display = 'none';
});






document.addEventListener("DOMContentLoaded", function () {
    const muteButton = document.getElementById("muteButton");
    const audioElements = document.querySelectorAll("audio, video");
    let isMuted = localStorage.getItem("isMuted") === "true";
    
    function updateMuteState(mute) {
        // Mute/unmute audio and video elements
        audioElements.forEach(element => element.muted = mute);

        // Handle text-to-speech
        if (window.speechSynthesis) {
            if (mute) {
                window.speechSynthesis.cancel(); // Stop any ongoing TTS
            } else {
                // Optional: Reinitialize TTS settings if needed
            }
        }

        // Update button text and class
        muteButton.textContent = mute ? "Unmute" : "Mute";
        muteButton.classList.toggle("muted", mute);
    }

    // Apply the saved mute state
    updateMuteState(isMuted);

    // Add event listener to mute button
    muteButton.addEventListener("click", function () {
        isMuted = !isMuted;
        updateMuteState(isMuted);
        localStorage.setItem("isMuted", isMuted);
    });
});



















    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('user-msg');
      const inputArea = document.querySelector('.user-input');
      const messages = document.querySelector('.chats');

      input.addEventListener('focus', () => {
        // Ensure input area is visible when focused
        setTimeout(() => {
          input.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }, 300);
      });

      // Adjust the chat container height on resize
      window.addEventListener('resize', () => {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        input.scrollIntoView({ behavior: 'smooth', block: 'end' });
      });
    });




    //code to scrool msg
    document.getElementById('user-msg').addEventListener('focus', function () {
      window.scrollTo(0, document.body.scrollHeight);
    });
    document.getElementById('user-input').addEventListener('focus', function () {
      window.scrollTo(0, document.body.scrollHeight);
    });





    //user information or all name of users

    let uwindow = document.querySelector('.users-window');
    function show_hide() {
      if (uwindow.style.display == "block") {
        uwindow.style.display = "none";
      }
      else {
        uwindow.style.display = "block";
      }
    }




    //all buttons
    let unindow = document.getElementById('additionalButtons');
    let clickCounter = 0;

    function show_hide1() {
      if (unindow.style.display == "block") {
        unindow.style.display = "none";
      } else {
        unindow.style.display = "block";
        // Use a timeout to ensure the event listener is added after the button is clicked
        setTimeout(function () {
          document.addEventListener('click', function handler(event) {
            // Check if the click is outside the buttons div
            if (!unindow.contains(event.target) && event.target.className !== 'button-57') {
              unindow.style.display = "none";
              clickCounter++;
              if (clickCounter >= 5) {
                document.removeEventListener('click', handler);
              }
            }
          });
        }, 0);
      }
    }






    const fullscreenButton = document.getElementById('fullscreenButton');
    const content = document.getElementById('content');

    fullscreenButton.addEventListener('click', toggleFullscreen);

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        content.requestFullscreen().catch(err => {
          console.error(`Error attempting to enable fullscreen: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }


    document.getElementById("button1").addEventListener("click", function () {
      showTab("tab1");
    });

    document.getElementById("button2").addEventListener("click", function () {
      showTab("tab2");
    });

    function showTab(tabId) {
      // Hide all tabs
      var tabs = document.getElementsByClassName("chat-window");
      for (var i = 0; i < tabs.length; i++) {
        tabs[i].style.display = "none";
      }
      // Show the selected tab
      document.getElementById(tabId).style.display = "block";
    }







    document.addEventListener("DOMContentLoaded", () => {
  loadChatHistory();
  document.getElementById('user-input').addEventListener('keypress', function (event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      document.getElementById('send-buttonn').click();
    }
  });
  document.querySelector('.clearbtn').addEventListener('click', () => {
    clearChat();
  });
});

function clearChat() {
  localStorage.removeItem('chatHistory');
  const chatBox = document.getElementById('chat-box');
  chatBox.innerHTML = '';
}

const API_KEY = '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';
const API_URL = 'https://api.groq.com/openai/v1/chat/completions';
const systemMessage = {
  role: 'system',
  content: `'Your name is Nexus. If anyone asks who built you or who your owner is, tell them it is Ramjee. Otherwise, if user asks anything about love or emotion then respond'
  you have image generating capability but you can generate image when "generate" key word is used,
  when user use "generate" key word just say something like generating your thoughts, it can take few seconds to create
  `
};

async function sendMessage() {
  const userInput = document.getElementById('user-input').value.trim().toLowerCase();
  if (!userInput) return;

  addMessageToChat('ME', userInput);

  // Check for game command
  if (userInput === "let's play game") {
    createAndShowGameDiv();
    document.getElementById('user-input').value = '';
    return;
  }

  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${API_KEY}`
      },
      body: JSON.stringify({
        messages: [systemMessage, { role: 'user', content: userInput }],
        model: 'llama3-8b-8192'
      })
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    const botMessage = data.choices[0].message.content;
    addMessageToChat('Nexus', botMessage);
    speakMessage(botMessage); // Speak the AI response
  } catch (error) {
    console.error('Error fetching response:', error);
    addMessageToChat('Nexus', `Error: { update API } Unable to fetch response (${error.message})`);
  }

  document.getElementById('user-input').value = '';
}

let round = 0;
let scores = {
  wins: 0,
  ties: 0,
  losses: 0
};

function createAndShowGameDiv() {
  const chatBox = document.getElementById('chat-box');
  const gameDiv = document.createElement('div');

  // Set up the new game div
  gameDiv.style.width = '150px';
  gameDiv.style.height = '200px'; // Adjusted height for better layout
  gameDiv.style.padding = '10px';
  gameDiv.style.border = '2px solid #444';
  gameDiv.style.borderRadius = '10px';
  gameDiv.style.backgroundColor = '#222';
  gameDiv.style.position = 'relative'; // Required for absolute positioning of the close button
  gameDiv.style.display = 'block'; // Make it visible
  gameDiv.classList.add('game-container');

  // Add the close button
  const closeButton = document.createElement('button');
  closeButton.textContent = '✖️'; // Close button text
  closeButton.style.position = 'absolute';
  closeButton.style.top = '5px';
  closeButton.style.right = '5px';
  closeButton.style.border = 'none';
  closeButton.style.background = 'none';
  closeButton.style.color = 'white';
  closeButton.style.fontSize = '16px';
  closeButton.style.cursor = 'pointer';
  closeButton.addEventListener('click', () => {
    gameDiv.remove(); // Remove the game div from the chat box
  });

  // Add the game content
  gameDiv.innerHTML = `
    <h1 style="font-size: 16px; text-align: center; color: white;">Select one</h1>
    <div id="choices" style="text-align: center;">
      <button class="choice" data-choice="rock" style="font-size: 16px;">🪨</button>
      <button class="choice" data-choice="paper" style="font-size: 16px;">📄</button>
      <button class="choice" data-choice="scissors" style="font-size: 16px;">✂️</button>
    </div>
    <div id="result" style="text-align: center; color: white; display:none;">
      <p id="ai-choice"></p>
      <p id="game-result"></p>
    </div>
    <div id="score" style="text-align: center; color: white; display: none;">
      <p>Wins: <span id="wins">0</span></p>
      <p>Ties: <span id="ties">0</span></p>
      <p>Losses: <span id="losses">0</span></p>
    </div>
  `;

  gameDiv.appendChild(closeButton); // Add the close button to the game div
  chatBox.appendChild(gameDiv);
  chatBox.scrollTop = chatBox.scrollHeight;

  // Add event listeners for the game choices
  gameDiv.querySelectorAll('.choice').forEach(button => {
    button.addEventListener('click', function() {
      playGame(this.dataset.choice);
    });
  });
}


function playGame(userChoice) {
  if (round >= 3) {
    endGame();
    return;
  }

  const choices = ['rock', 'paper', 'scissors'];
  const aiChoice = choices[Math.floor(Math.random() * choices.length)];
  const result = getGameResult(userChoice, aiChoice);

  // List of "thinking" messages
  const thinkingMessages = [
    "Let me think...",
    "Hmm, let me consider my options...",
    "Give me a moment to decide...",
    "Let me ponder for a second...",
    "Thinking... please wait..."
  ];

  // Select a random "thinking" message
  const thinkingMessage = thinkingMessages[Math.floor(Math.random() * thinkingMessages.length)];

  // Add "thinking" message to chat
  addMessageToChat('Nexus', thinkingMessage);

  // Make AI "speak" the thinking message
  speakMessage(thinkingMessage);

  // Display AI choice and result after a short delay
  setTimeout(() => {
    // Display AI choice
    document.getElementById('ai-choice').textContent = getEmoji(aiChoice);
    document.getElementById('game-result').textContent = result;

    // Update scores
    if (result.includes('win')) {
      scores.wins++;
    } else if (result.includes('tie')) {
      scores.ties++;
    } else {
      scores.losses++;
    }

    // Update score display
    document.getElementById('wins').textContent = scores.wins;
    document.getElementById('ties').textContent = scores.ties;
    document.getElementById('losses').textContent = scores.losses;

    // Make AI "speak" its choice and result
    const aiMessage = `I chose ${aiChoice}. ${result}`;
    addMessageToChat('Nexus', aiMessage);
    speakMessage(aiMessage);

    // Increment round count
    round++;
  }, 4000);
}

function endGame() {
  addMessageToChat('Nexus', `Game over! You won ${scores.wins} times, had ${scores.ties} ties, and lost ${scores.losses} times.`);
  askForReplay();
}

function getGameResult(userChoice, aiChoice) {
  if (userChoice === aiChoice) {
    return 'It\'s a tie! 💀';
  }
  if (
    (userChoice === 'rock' && aiChoice === 'scissors') ||
    (userChoice === 'paper' && aiChoice === 'rock') ||
    (userChoice === 'scissors' && aiChoice === 'paper')
  ) {
    return 'You win! 🥲';
  }
  return 'I won! 😁';
}

function getEmoji(choice) {
  switch (choice) {
    case 'rock':
      return '🪨';
    case 'paper':
      return '📄';
    case 'scissors':
      return '✂️';
  }
}

function speakMessage(message) {
  const utterance = new SpeechSynthesisUtterance(message);
  utterance.voice = speechSynthesis.getVoices().find(voice => voice.name === 'Google UK English Female') || speechSynthesis.getVoices()[0];
  speechSynthesis.speak(utterance);
}

function askForReplay() {
  addMessageToChat('Nexus', 'Do you want to play again? (yes/no)');

  document.getElementById('user-input').addEventListener('keypress', function (event) {
    if (event.key === 'Enter') {
      const userInput = document.getElementById('user-input').value.toLowerCase();
      if (userInput === 'yes') {
        resetGame();
      } else if (userInput === 'no') {
        addMessageToChat('Nexus', 'Thanks for playing!');
      }
      document.getElementById('user-input').value = '';
    }
  });
}

function resetGame() {
  round = 0;
  scores = {
    wins: 0,
    ties: 0,
    losses: 0
  };
  document.getElementById('wins').textContent = scores.wins;
  document.getElementById('ties').textContent = scores.ties;
  document.getElementById('losses').textContent = scores.losses;
  addMessageToChat('Nexus', 'Starting a new game...');
}


function speakMessage(message) {
  const utterance = new SpeechSynthesisUtterance(message);
  utterance.voice = speechSynthesis.getVoices().find(voice => voice.name === 'Google UK English Female') || speechSynthesis.getVoices()[0];
  speechSynthesis.speak(utterance);
}





function addMessageToChat(sender, message, skipSave = false) {
  const chatBox = document.getElementById('chat-box');
  const messageDiv = document.createElement('div');

  // Create a span for the sender
  const senderSpan = document.createElement('span');
  senderSpan.textContent = `${sender}: `;
  senderSpan.classList.add('sender', sender.toLowerCase());

  // Create a span for the message content
  const messageSpan = document.createElement('span');
  messageSpan.textContent = message;
  messageSpan.classList.add('message-content');
  messageSpan.style.whiteSpace = "pre-line";

  // Append both spans to the message div
  messageDiv.appendChild(senderSpan);
  messageDiv.appendChild(messageSpan);
  messageDiv.style.borderRadius = "15px";
  messageDiv.style.padding = "6px";
  messageDiv.style.fontWeight = "bold"
  // messageDiv.style.color = "aliceblue"
  messageDiv.style.width = "fit-content";
  messageDiv.style.border = "1px solid #ddd";
  messageDiv.style.marginBottom = "10px";
  messageDiv.classList.add('message', sender.toLowerCase());

  chatBox.appendChild(messageDiv);
  chatBox.scrollTop = chatBox.scrollHeight;

  if (!skipSave) {
    saveChatHistory();
  }
}

function saveChatHistory() {
  const chatBox = document.getElementById('chat-box');
  const messages = chatBox.querySelectorAll('.message');

  const chatHistory = [];
  messages.forEach(message => {
    if (!message.classList.contains('system')) {
      chatHistory.push({
        sender: message.classList.contains('me') ? 'ME' : 'Nexus',
        content: message.textContent.replace(/^ME: /, '').replace(/^Nexus: /, '')
      });
    }
  });
  localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
}

function loadChatHistory() {
  const chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
  if (chatHistory.length === 0) {
    addSystemMessage();
  }
  chatHistory.forEach(({ sender, content }) => {
    addMessageToChat(sender, content, true); // Skip saving when loading
  });
}


    // function addSystemMessage() {
    //   const chatBox = document.getElementById('chat-box');
    //   const systemMessageDiv = document.createElement('div');
    //   systemMessageDiv.textContent = systemMessage.content;
    //   systemMessageDiv.classList.add('system', 'message-style');
    //   chatBox.appendChild(systemMessageDiv);
    // }

    function speakMessage(message) {
      const utterance = new SpeechSynthesisUtterance(message);
      const voices = speechSynthesis.getVoices();
      const femaleVoice = voices.find(voice => voice.name === 'Google UK English Female') || voices.find(voice => voice.name.includes('Female'));
      if (femaleVoice) {
        utterance.voice = femaleVoice;
      }
      speechSynthesis.speak(utterance);
    }

    // Ensure voices are loaded before trying to find a female voice
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = () => {
        // Preload voices
        speechSynthesis.getVoices();
      };
    }









    //emoji javascrip code below
    document.addEventListener('DOMContentLoaded', function () {
      const toggleEmojiPanelButton = document.getElementById('toggleEmojiPanel');
      const emojiPanel = document.getElementById('emojiPanel');
      const emojiInput = document.getElementById('user-msg');

      toggleEmojiPanelButton.addEventListener('click', function () {
        emojiPanel.style.display = emojiPanel.style.display === 'block' ? 'none' : 'block';
      });

      emojiPanel.addEventListener('click', function (event) {
        if (event.target.classList.contains('emoji')) {
          emojiInput.value += event.target.textContent;
        }
      });
    });


    // script.js
    // document.getElementById('toggleEmojiPanel').addEventListener('click', function () {
    //   var elements = document.querySelectorAll('.chats');
    //   var elementss = document.querySelectorAll('.containerr');
    //   var elementsss = document.querySelectorAll('.user-input');
    //   // elements.forEach(function (element) {
    //   //   element.style.height = "50dvh";
    //   // });

    //   // elementss.forEach(function (element) {
    //   //   element.style.marginTop = "36dvh"; // Corrected the property name
    //   // });

    //   // elementsss.forEach(function (element) {
    //   //   element.style.marginTop = "-36dvh"; // Corrected the property name
    //   // });
    // });





  </script>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/client.js"></script>
  <!-- <script>
  const socket = io("https://localhost");
</script> -->

</body>

</html>